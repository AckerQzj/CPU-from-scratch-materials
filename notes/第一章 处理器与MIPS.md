# 架构与指令集

ISA，指令集架构把编程所需要了解的硬件信息从硬件系统中抽象出来，面向ISA开发，ISA是抽象机器而非具体实现

微架构：架构的一个实现，如 Intel  的许多处理器都是遵循 x86 的 ISA, 但 是每一款处理器都有自己的微架构。 ISA 好比是设计规范, 微架构则是具体实现, 同样的 ISA, 不 同的微架构, 会带来不同的性能

# CISC RISC

RISC 并不只是简单地减少指令,更主要的目的是研究如何使计算机的结构更加简单合理以提高运算速度。 其特点是指令长度固定、 指令格式种类少、寻址方式种类少、大量使用寄存器等。 由于在RISC中使用 的指令大多数是简单指令且都能在一个时钟周期内完成, 因而处理器的频率得以大幅提升

# MIPS

MIPS是RISC CPU的重要代表，设计基于以下理念: 使 用相对简单的指令,结合优秀的编译器以及采用流水线执行指令的硬件, 就可以用更少的晶元面积生产更快的处理器。

# MIPS32架构

本节介绍的MIPS32指令集架构指 的就是 MIPS32 Release 1 。

### 数据类型

指令的主要任务就是对操作数进行运算, 操作数有不同的类型和长度, MIPS32 提供的基本数据类型如下。  

● 位 (b): 长度是 1bit 。

● 字节 (Byte): 长度是8bit 。  

● 半字 (HalfWord): 长 度是 16bit。 

● 字 (Word): 长度是32bit 。 

● 双字 (Double Word): 长度是 64bit。  

此外,还有 32位 单精度浮点数、 64位双精度浮点数等 。

### 寄存器

MIPS架构大量使用寄存器，这是因为寄存器的存取可以在 一个时钟周期内完成 , 同时也简化了寻址方式。

MIPS32 的指令中除加载/存储指令外 ,都是用寄存器或立即数作为操作数的。 MIPS32 中的寄存器分为两类: 通用寄存器 (General  Purpose Register, GPR)、 特殊寄存器。

#### 通用寄存器

32个通用寄存器，编号为S0、 S1...$31 表 示, 都 是 32 位 。 其 中SO 一  般用做常量 0 。

#### 特殊寄存器

MIPS32架构中定义的特殊寄存器有三个: PC (Program Counter程序计数器)、 HI (乘除  结果高位寄存器)、 LO (乘除结果低位寄存器)。 进 行乘法运算时, HI 和 LO保存乘法运算的  结果, 其 中 H 存储高 32位 , LO存储低 32位 ; 进行除法运算时,HI和 LO保 存除法运算的  结果,其 中 HI存 储余数 , LO存储商。

### 字节序

大端模式：MSB，先存高位（高位数据放在低地址处）

小端模式：LSB，先存低位

本文的OpenMIPS处理器使用的是大端模式

### 指令格式

MIPS32中的所有指令都是32位

三种指令类型：

R类型：具体操作由 op、 func结合指定,rs和rt是源寄存器的编号, rd是目的寄存器的编号

I类型: 具体操作由 op指定,指 令的低 16位是立即数, 运算时要将其扩展至32位,  然后作为其中一个源操作数参与运算。

J 类型: 具体操作由 op 指定,一般是跳转指令,低 26 位是字地址,用于产生跳转 的目标地址。

### 指令集

本文我们使用汇编指令，使用汇编程序将汇编指令翻译为计算机可以识别的 0、 1 编码。

MIPS32 架构中定义的指令可以分为以下几类 。  注意: 其 中不包括浮点指令, 因为本书实现的处理器不包含浮点处理单元, 也就没有实现浮  点指令, 所 以此处不介绍浮点指令。

### 寻址方式

MIPS32 架构的寻址模式有寄存器寻址、 立即数寻址、 寄存器相对寻址和 PC相对寻址四种。

### 协处理器

协处理器常用来表示处理器的一个可选部件，负责处理指令集的某个拓展，拥有和处理器独立的寄存器

MIPS32架 构提供了最多4个 协处理器, 分 别是CPO~CP3。

